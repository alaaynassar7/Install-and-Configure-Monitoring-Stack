- name: Wait for Grafana API to be ready
  ansible.builtin.wait_for:
    host: localhost
    port: 3000
    delay: 5
    timeout: 60

- name: Import Grafana dashboard using API
  ansible.builtin.uri:
    url: "http://localhost:3000/api/dashboards/db"
    method: POST
    user: admin
    password: admin
    force_basic_auth: yes
    headers:
      Content-Type: "application/json"
    body_format: json
    body: >
      {
        "dashboard": {{ lookup('file', role_path + '/files/api-dashboards/node-exporter.json') }},
        "overwrite": true
      }
    status_code: 200

